<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<title>Đỏ Xanh Tracker</title>

<style>
body{
  font-family:Arial, sans-serif;
  max-width:420px;
  margin:auto;
  padding:12px;
  background:#f2f2f2;
}

.section{
  background:white;
  border-radius:14px;
  padding:12px;
  margin-bottom:16px;
}

.color-box{
  width:32px;
  height:32px;
  border-radius:6px;
  margin-bottom:6px;
}

.red-box{background:#e60000}
.blue-box{background:#0077ff}

.input-row{
  display:flex;
  gap:6px;
}

input{
  flex:1;
  padding:8px;
  font-size:16px;
}

button{
  padding:6px 12px;
  font-size:16px;
  border-radius:6px;
}

.list{
  margin-top:8px;
  line-height:1.6;
  font-size:22px;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.total{
  text-align:right;
  font-size:32px;
  font-weight:bold;
  margin-top:6px;
}

.clear-all{
  width:100%;
  margin-top:20px;
  background:#000;
  color:white;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:#fff;
  padding:18px;
  border-radius:14px;
  width:80%;
  text-align:center;
  font-size:20px;
}

.modal-box button{
  margin:6px;
}
</style>
</head>
<body>

<div class="section">
  <div class="color-box red-box"></div>
  <div class="input-row">
    <input id="redInput" placeholder="VD: 200/100 Tên">
    <button onclick="addRed()">+</button>
  </div>
  <div id="redList" class="list"></div>
  <div id="redTotal" class="total">0/0</div>
</div>

<div class="section">
  <div class="color-box blue-box"></div>
  <div class="input-row">
    <input id="blueInput" placeholder="VD: 50/100 Tên">
    <button onclick="addBlue()">+</button>
  </div>
  <div id="blueList" class="list"></div>
  <div id="blueTotal" class="total">0/0</div>
</div>

<button class="clear-all" onclick="openClearAll()">XÓA TẤT CẢ</button>

<div id="modal" class="modal">
  <div class="modal-box">
    <div id="modalText"></div>
    <button onclick="confirmAction()">CÓ</button>
    <button onclick="closeModal()">KHÔNG</button>
  </div>
</div>

<script>
let redData = JSON.parse(localStorage.getItem("redData")) || [];
let blueData = JSON.parse(localStorage.getItem("blueData")) || [];

let action=null, target=null;

function getVNTime(){
  return new Date().toLocaleTimeString("vi-VN",{hour:'2-digit',minute:'2-digit'});
}

function parseInput(v){
  let parts=v.trim().split(" ");
  let nums=parts[0];
  let note=parts.slice(1).join(" ") || "";
  let p=nums.split("/");
  if(p.length!==2) return null;
  return {a:+p[0], b:+p[1], raw:nums, note:note};
}

function addRed(){
  let p=parseInput(redInput.value);
  if(!p||isNaN(p.a)||isNaN(p.b)) return alert("Nhập dạng 200/100");
  redData.push({raw:p.raw,note:p.note,time:getVNTime()});
  redInput.value="";
  save(); render();
}

function addBlue(){
  let p=parseInput(blueInput.value);
  if(!p||isNaN(p.a)||isNaN(p.b)) return alert("Nhập dạng 50/100");
  blueData.push({raw:p.raw,note:p.note,time:getVNTime()});
  blueInput.value="";
  save(); render();
}

function openDelete(type,i){
  action="delete";
  target={type,i};
  let e=type==="red"?redData[i]:blueData[i];
  modalText.innerText=`${e.raw} - ${e.note} - ${e.time}`;
  modal.style.display="flex";
}

function openClearAll(){
  action="clear";
  modalText.innerText="Bạn có chắc muốn xóa TẤT CẢ lịch sử?";
  modal.style.display="flex";
}

function confirmAction(){
  if(action==="delete"){
    if(target.type==="red") redData.splice(target.i,1);
    if(target.type==="blue") blueData.splice(target.i,1);
  }
  if(action==="clear"){
    redData=[];
    blueData=[];
    localStorage.removeItem("redData");
    localStorage.removeItem("blueData");
  }
  save(); render(); closeModal();
}

function closeModal(){
  modal.style.display="none";
}

function save(){
  localStorage.setItem("redData",JSON.stringify(redData));
  localStorage.setItem("blueData",JSON.stringify(blueData));
}

function calc(raw){
  let p=raw.split("/");
  return {a:+p[0], b:+p[1]};
}

function render(){
  let rA=0,rB=0,bA=0,bB=0;

  redList.innerHTML = redData.map((e,i)=>{
    let p=calc(e.raw);
    rA+=p.a; rB+=p.b;
    return `
      <div class="row">
        <div>${i+1}. ${e.raw} - ${e.note} - ${e.time}</div>
        <button onclick="openDelete('red',${i})">XÓA</button>
      </div>`;
  }).join("");

  blueList.innerHTML = blueData.map((e,i)=>{
    let p=calc(e.raw);
    bA+=p.a; bB+=p.b;
    return `
      <div class="row">
        <div>${i+1}. ${e.raw} - ${e.note} - ${e.time}</div>
        <button onclick="openDelete('blue',${i})">XÓA</button>
      </div>`;
  }).join("");

  redTotal.textContent=`${rA}/${rB}`;
  blueTotal.textContent=`${bA}/${bB}`;
}

render();
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
